--- linux-4.14.14/drivers/gpu/drm/amd/amdgpu/amdgpu_device.c	2018-01-17 09:45:30.000000000 +0100
+++ linux-4.14.14-mod/drivers/gpu/drm/amd/amdgpu/amdgpu_device.c	2018-04-11 14:30:33.415511890 +0200
@@ -2899,8 +2902,10 @@
 
 			if (!ring || !ring->sched.thread)
 				continue;
-
-			amd_sched_job_recovery(&ring->sched);
+			if (amdgpu_abort_on_lockup)
+				amd_sched_job_abort(&ring->sched);
+			else
+				amd_sched_job_recovery(&ring->sched);
 			kthread_unpark(ring->sched.thread);
 		}
 	} else {
